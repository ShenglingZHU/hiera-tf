name: lint

on:
  pull_request:
    paths:
      - "packages/htf-js/**"
      - "apps/ui-static/**"
      - "packages/htf-py/**"
      - ".github/workflows/lint.yml"
  push:
    paths:
      - "packages/htf-js/**"
      - "apps/ui-static/**"
      - "packages/htf-py/**"
      - ".github/workflows/lint.yml"

jobs:
   js-biome:
     runs-on: ubuntu-latest
     steps:
       - uses: actions/checkout@v4
        with:
          sparse-checkout: |
            packages/htf-js
            apps/ui-static
           sparse-checkout-cone-mode: false

       - uses: actions/setup-node@v4
         with:
           node-version: "20"
           cache: 'npm'
           cache-dependency-path: packages/htf-js/package-lock.json

      - name: Install JS deps
        run: npm install --no-fund --no-audit --ignore-scripts
        working-directory: packages/htf-js
      - name: Biome CI
        run: npm run ci
        working-directory: packages/htf-js

   py-ruff:
     runs-on: ubuntu-latest
     steps:
       - uses: actions/checkout@v4
        with:
          sparse-checkout: |
            packages/htf-js
            packages/htf-py
            apps/ui-static
           sparse-checkout-cone-mode: false

       - uses: actions/setup-python@v5
        with:
          python-version: "3.11"
          cache: 'pip'
          cache-dependency-path: packages/htf-py/pyproject.toml
      - name: Upgrade pip
        run: python -m pip install -U pip
        working-directory: packages/htf-py
      - name: Install Python deps
        run: python -m pip install -e .[lint]
        working-directory: packages/htf-py
      - name: Ruff check
        run: ruff check .
        working-directory: packages/htf-py
      - name: Ruff format check
        run: ruff format --check .
        working-directory: packages/htf-py
